
<div class="page-banner-box bg-8">
    <h3>Live Chat</h3>
</div>

<div class="live-chat-slides owl-carousel owl-theme">

    @foreach (var item in ViewBag.dto.Users)
    {
        @if (item.IsOnline)
        {
            @if (item.Id != ViewBag.dto.CurrentUser.Id)
            {

                <div onclick="GoChat(@item,@ViewBag.dto.CurrentUser)" class="chat-box">
                    <div class="image">
                        <a href="#"><img src="~/images/profile.png" class="rounded-circle" alt="image"></a>
                        <span class="status-online"></span>
                    </div>
                    <h3>
                        <a href="#">@item.Name</a>
                    </h3>
                </div>
            }

        }
    }
</div>

<div id="liveChatContainer" class="live-chat-body">
</div>
<script>
       function SendMessageAjax(recieverId, senderId) {


        var userInput = document.getElementById("user-message");
        var message = userInput.value;

        if (message) {
            SendMessageHub(senderId,message)

            //await connection.invoke("SendChat", currentUser, message);
            userInput.value = "";
        }

        //let obj = {
        //    "recieverId" = recieverId,
        //    "senderId" = senderId,
        //    "message" = message
        //}
        //$.ajax({
        //    url: '@Url.Action("SendMessage", "Home")',
        //    type: 'POST',
        //    data: JSON.stringify(obj),
        //    success: function (response) {
        //        // Handle the successful response from the server
        //        console.log(response);
        //    },
        //    error: function (xhr, status, error) {
        //        // Handle any errors that occurred during the AJAX request
        //        console.error(error);
        //    }
        //});



    }

    function GoChat(reciever, sender) {
        $("#liveChatContainer").innerHTML = `
            <div class="live-chat-header d-flex justify-content-between align-items-center">
                <div class="live-chat-info">
                    <a href="#"><img src="~/assets/images/user/user-11.jpg" class="rounded-circle" alt="image"></a>
                    <h3>
                            <a>`${ reciever.name } ` `${ reciever.surname } `</a>
                    </h3>
                </div>

                <ul class="live-chat-right">
                    <li>
                        <button class="btn d-inline-block" data-bs-toggle="tooltip" data-bs-placement="top" title="Phone" type="button"><i class="ri-phone-fill"></i></button>
                    </li>
                    <li>
                        <button class="btn d-inline-block" data-bs-toggle="tooltip" data-bs-placement="top" title="Live" type="button"><i class="ri-live-fill"></i></button>
                    </li>
                    <li>
                        <button class="btn d-inline-block" data-bs-toggle="tooltip" data-bs-placement="top" title="Delete" type="button"><i class="ri-delete-bin-line"></i></button>
                    </li>
                </ul>
            </div>

            <div class="live-chat-container">
                <div class="chat-content">



                </div>

                <div class="chat-list-footer">
                    <div class="btn-box d-flex align-items-center me-3">
                        <button class="file-attachment-btn d-inline-block me-2" data-bs-toggle="tooltip" data-bs-placement="top" title="File Attachment" type="button"><i class="ri-attachment-2"></i></button>

                        <button class="emoji-btn d-inline-block" data-bs-toggle="tooltip" data-bs-placement="top" title="Emoji" type="button"><i class="ri-user-smile-line"></i></button>
                    </div>

                    <input id="user-message" type="text" class="form-control" placeholder="Type your message...">

                    <button onclick="SendMessageAjax(`${ reciever.id } `,`${ sender.id } `)" class="send-btn d-inline-block">Send</button>
                </div>
            </div>
            `
    }
</script>

<script src="~/js/signalr/dist/browser/signalr.js"></script>
<script src="~/js/chat.js"></script>
<script src="~/js/site.js"></script>
